# CI/CD

gitlabçš„ciæ–‡æ¡£https://docs.gitlab.com/ci/

## 1ã€ä»€ä¹ˆæ˜¯CI/CD

è‡ªåŠ¨åŒ–ç®¡ç†é¡¹ç›®ã€éƒ¨ç½²é¡¹ç›®çš„å·¥å…·

### 1.1 CIï¼šcontinuous integration æŒç»­é›†æˆ

æ¯æ¬¡æäº¤åˆ°ä¸»åˆ†æ”¯è‡ªåŠ¨è§¦å‘æ„å»ºå’Œæµ‹è¯•ï¼Œä¿è¯ä»£ç çš„å…¼å®¹æ€§å’Œæ­£ç¡®æ€§ã€‚

å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

1. ä»£ç æäº¤ï¼šä»£ç æ¨é€åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚gitï¼‰
2. è‡ªåŠ¨æ„å»ºï¼šç³»ç»Ÿè‡ªåŠ¨ç¼–è¯‘ä»£ç å¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶
3. è‡ªåŠ¨æµ‹è¯•ï¼šè¿è¡Œå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ç­‰
4. åé¦ˆï¼šæµ‹è¯•ç»“æœ

### 1.2 CDï¼šcontinuous delivery æŒç»­äº¤ä»˜ / continuous deployment æŒç»­éƒ¨ç½²

1. æŒç»­äº¤ä»˜ï¼šåœ¨ CI åŸºç¡€ä¸Šï¼Œç¡®ä¿ä»£ç **éšæ—¶å¯æ‰‹åŠ¨å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒ**
2. æŒç»­éƒ¨ç½²ï¼šè‡ªåŠ¨å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### 1.3 æµç¨‹

ä»£ç æäº¤ ã€‹ã€‹è‡ªåŠ¨æ„å»º ã€‹ã€‹è‡ªåŠ¨åŒ–æµ‹è¯• ã€‹ã€‹ç”Ÿæˆå¯éƒ¨ç½²åŒ… ã€‹ã€‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

------------------ciæŒç»­é›†æˆ------------ï½œ---cdæŒç»­äº¤ä»˜--ï½œ---cdæŒç»­éƒ¨ç½²---

## 2ã€é¡¹ç›®éƒ¨ç½²çš„å‡ ç§æ–¹æ³•

### 2.1 ä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²

1. æœ¬åœ°ç”Ÿæˆçš„distäº§ç‰©
2. å°†æ„å»ºæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨
3. é…ç½®webæœåŠ¡å™¨æŒ‡å‘é™æ€æ–‡ä»¶ç›®å½•

### 2.2 è‡ªåŠ¨åŒ–éƒ¨ç½²å·¥å…·ï¼ˆCI/CDï¼‰

æœ€ç®€å•çš„ğŸŒ°ï¼š

1. ä»£ç ä¸Šä¼ åˆ°gitlab
2. gitlabæ„å»ºé¡¹ç›®äº§ç‰©
3. äº§ç‰©ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆå½“ç„¶æœåŠ¡å™¨è¦é…ç½®å¥½é¡¹ç›®ç¯å¢ƒï¼‰
4. è‡ªåŠ¨ç”Ÿæ•ˆ

### 2.3 å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆdockerï¼‰

1. ç¼–å†™dockerfileï¼Œå®šä¹‰nodeå’Œnginxç¯å¢ƒ

   ```
   # ä½¿ç”¨ Node.js é•œåƒæ„å»ºé¡¹ç›®
   FROM node:18 as builder
   WORKDIR /app
   COPY package*.json ./
   RUN npm install
   COPY . .
   RUN npm run build
   
   # ä½¿ç”¨ Nginx é•œåƒæ‰˜ç®¡é™æ€æ–‡ä»¶
   FROM nginx:alpine
   COPY --from=builder /app/dist /usr/share/nginx/html
   EXPOSE 80
   CMD ["nginx", "-g", "daemon off;"]
   ```

2. æ„å»ºé•œåƒå¹¶æ¨é€åˆ°é•œåƒä»“åº“ï¼ˆå…¬å¸ç”¨çš„æ˜¯gitlabçš„é•œåƒä»“åº“ï¼‰

   ```
   docker build -t my-frontend-app:latest .
   
   æ¨é€åˆ°é˜¿é‡Œäº‘é•œåƒ
   docker tag my-frontend-app:latest registry.cn-hangzhou.aliyuncs.com/your-namespace/my-frontend-app:latest
   docker push registry.cn-hangzhou.aliyuncs.com/your-namespace/my-frontend-app:latest
   ```

   ç»“åˆciæ–‡ä»¶é…ç½®ï¼Œå¯ä»¥çœå»æ‰‹åŠ¨è¿‡ç¨‹

   ```
   build-and-push:
     stage: deploy
     script:
       - docker build -t my-frontend-app:latest .
       - docker push username/my-frontend-app:latest
   ```

3. åœ¨æœåŠ¡å™¨æ‹‰å–æœ€æ–°é•œåƒå¹¶éƒ¨ç½²å®¹å™¨ï¼Œå°±å¯ä»¥è®¿é—®

   ```
   # æ‹‰å–é•œåƒï¼ˆå¦‚æœå·²æ¨é€ï¼‰
   docker pull username/my-frontend-app:latest
   
   # è¿è¡Œå®¹å™¨
   docker run -d -p 80:80 --name my-app my-frontend-app:latest
   ```

### 2.4 é™æ€æ‰˜ç®¡ä¸CDNæœåŠ¡

æ— éœ€ç®¡ç†æœåŠ¡å™¨ï¼Œç›´æ¥æ‰˜ç®¡é™æ€æ–‡ä»¶å¹¶åŠ é€Ÿè®¿é—®ã€‚

å…¬å¸é¡¹ç›®èµ„æºä¸Šä¼ åˆ°ä¸ƒç‰›äº‘ï¼Œå¯ä»¥ç›´æ¥è®¿é—®bucketä¸­çš„èµ„æº

https://rbebag-zy-test.strongwind.cn/ai-learn-pc/2025219/index.html



å‘ç°çš„ç°è±¡ï¼š

1. åœ¨ç›¸åŒæµè§ˆå™¨æ‰“å¼€è¿™ä¸ªç½‘é¡µçš„æ—¶å€™ï¼Œå¯ä»¥æ­£å¸¸è¯·æ±‚èµ„æºï¼Œåœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ­£å¸¸ç‚¹å‡»ï¼Œè·³è½¬é¡µé¢

2. åˆ·æ–°é¡µé¢ä¹‹åï¼Œä¼šæŠ¥è¿™ä¸ªé”™è¯¯

   ![image-20250225145330317](/Users/soup/Library/Application Support/typora-user-images/image-20250225145330317.png)

3. è¿›å…¥åˆ°è¿™ä¸ªindex.htmlvueåº”ç”¨ä¼šæ ¹æ®createWebHistoryè½¬å‘ç™»é™†é¡µé¢

è¿™ä¸ªé¡¹ç›®ä¸­ä½¿ç”¨çš„æ˜¯`createWebHistory`æ¨¡å¼ï¼Œä¸ƒç‰›äº‘æœåŠ¡å™¨ä¸­åªæœ‰é™æ€èµ„æºï¼Œæ²¡æœ‰nginxæœåŠ¡å™¨ï¼Œnginxåœ¨è¿™é‡Œä¸»è¦ç”¨äºå°†vueé¡¹ç›®çš„è¯·æ±‚è½¬å‘index.htmlæ–‡ä»¶

- é¦–æ¬¡è®¿é—®çš„æ—¶å€™
  1. æµè§ˆå™¨è®¿é—®ä¸Šé¢çš„è¿™ä¸ªurlï¼Œå°±å‘ä¸ƒç‰›äº‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè¿”å›è¿™ä¸ªindex.html
  2. æ ¹æ®è¿™ä¸ªindex.htmlå»è§£æjsã€htmlã€cssï¼ŒåŠ è½½è¿™ä¸ªvueåº”ç”¨ï¼Œä¹ŸåŒ…å«äº†è¿™ä¸ªè·¯ç”±é…ç½®ï¼Œå³å®¢æˆ·ç«¯çš„è·¯ç”±é…ç½®
  3. åŠ è½½å®Œä¹‹åï¼Œæ ¹æ®createWebHistoryé…ç½®å»åŒ¹é…è·¯ç”±è§„åˆ™ï¼Œè¿™æ ·èƒ½å¤Ÿæ­£å¸¸è®¿é—®
- åˆ·æ–°å½“å‰é¡µé¢
  1. å†æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œæµè§ˆå™¨å‘é€çš„æ˜¯ä¸€ä¸ªhttpè¯·æ±‚ï¼Œä¸ƒç‰›äº‘æœåŠ¡å™¨ä¼šæ ¹æ®urlå»æ‰¾å¯¹åº”çš„èµ„æº
  2. æ‰¾ä¸åˆ°å°±ä¼šæŠ¥é”™ï¼Œvueåº”ç”¨æ— æ³•æ­£å¸¸åŠ è½½

### 2.5 å¹³å°åŒ–éƒ¨ç½²

ç»“åˆå¤šç§æ–¹å¼è¿›è¡Œéƒ¨ç½²

1. é€‰æ‹©å¹³å°ï¼šå…¬å¸ç”¨çš„æ˜¯é˜¿é‡Œäº‘
2. é…ç½®é¡¹ç›®ï¼šdockerfile
3. è‡ªåŠ¨éƒ¨ç½²ï¼šci+gitlab+ç”Ÿæˆé•œåƒ
4. ciçš„deployé˜¶æ®µè®©é˜¿é‡Œäº‘å»æ‹‰å–é•œåƒéƒ¨ç½²

![image-20250515112952259](./assets/image-20250515112952259.png)

## 3ã€SSH

è¿æ¥è¿œç¨‹æœåŠ¡å™¨æœ‰ä¸¤ç§åè®®ï¼šhttpså’Œssh

### 3.1 ä»€ä¹ˆæ˜¯ssh

SSHï¼šSecure Shellï¼Œæ˜¯ä¸€ç§ç”¨äºå®‰å…¨è¿œç¨‹è®¿é—®å’Œç®¡ç†è®¡ç®—æœºçš„ç½‘ç»œåè®®ï¼Œåœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡**åŠ å¯†æŠ€æœ¯ä¿æŠ¤æ•°æ®ä¼ è¾“**ï¼Œ**é˜²æ­¢æ•æ„Ÿä¿¡æ¯åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«çªƒå¬æˆ–ç¯¡æ”¹**ã€‚

ç›¸å½“äºï¼Œ**æœ¬åœ°ç³»ç»Ÿè¿æ¥è¿œç¨‹æœåŠ¡å™¨ï¼Œç„¶åå»æ“ä½œè¿œç¨‹æœåŠ¡å™¨**ã€‚

gitä¸­ï¼Œsshä¸»è¦ç”¨äºå®‰å…¨åœ°è¿æ¥è¿œç¨‹ä»£ç ä»“åº“ï¼Œé€šè¿‡sshå¯†é’¥è®¤è¯å®Œåï¼š

- å…å¯†ç pull/pushä»£ç 

- æé«˜å®‰å…¨æ€§ï¼ˆé¿å…æ˜æ–‡ä¼ è¾“ï¼‰

- ç®¡ç†å¤šè´¦æˆ·

  æœ¬åœ°ç³»ç»Ÿç”Ÿæˆäº†ä¸€å¯¹å¯†é’¥ï¼Œç”¨æˆ·å…¬å¸çš„ä»“åº“ç”¨çš„æ˜¯gitlabï¼Œä¸ªäººè´¦æˆ·ç”¨çš„æ˜¯gitubï¼Œå¯ä»¥ç”¨åŒä¸€ä¸ªå…¬é’¥é…ç½®åœ¨gitlabå’Œgitubä¸­

### 3.2 sshçš„å·¥ä½œåŸç†

### 3.3 å¦‚ä½•åœ¨gitlabä¸­é…ç½®

- ç”Ÿæˆsshå¯†é’¥

  ```
  ssh-keygen -t rsa -C "your_email@example.com"
  ```

  -tï¼šæŒ‡å®šå¯†é’¥ç±»å‹ï¼Œrsaã€Ed25519

  -Cï¼šåœ¨gitlabä¸­é…ç½®çš„é‚®ç®±

- åœ¨å­˜å‚¨çš„æ–‡ä»¶å¤¹ä¸­ä¼šæœ‰è¿™å‡ ä¸ªæ–‡ä»¶

  åœ¨æ ¹ç›®å½•çš„sshæ–‡ä»¶å¤¹ä¸­ï¼Œå‘½ä»¤ ï½/.ssh

  ![image-20250222115313794](/Users/soup/Library/Application Support/typora-user-images/image-20250222115313794.png)

  å°†å…¬é’¥é…ç½®åˆ°gitlabä¸­å°±å¯ä»¥é…ç½®å®Œæˆäº†

  ![image-20250222115510933](/Users/soup/Library/Application Support/typora-user-images/image-20250222115510933.png)

  å¦‚æœæ˜¯æœåŠ¡ç«¯ï¼Œè¿™é‡Œä¼šæœ‰å¦ä¸€ä¸ªæ–‡ä»¶ï¼Œauthorized_keysï¼Œç”¨æ¥å­˜æ”¾è¿æ¥å®¢æˆ·ç«¯çš„å…¬é’¥

- ç”Ÿæˆçš„sshå¯†é’¥

  ç§é’¥æ–‡ä»¶id_rsaï¼šç§é’¥æ–‡ä»¶ï¼ŒåŒ…å«èº«ä»½éªŒè¯çš„æ•æ„Ÿä¿¡æ¯

  å…¬é’¥æ–‡ä»¶id_rsa.pubï¼šå…¬é’¥æ–‡ä»¶ï¼Œå¯ä»¥åˆ†äº«ç»™éœ€è¦éªŒè¯ä½ èº«ä»½çš„æœåŠ¡å™¨æˆ–å¹³å°

  known_hostsï¼šæ˜¯sshå®¢æˆ·ç«¯ç”¨æˆ·å­˜å‚¨**å·²è¿æ¥è¿‡çš„è¿œç¨‹ä¸»æœºçš„èº«ä»½ä¿¡æ¯**

  1. å½“é¦–æ¬¡ä½¿ç”¨sshè¿æ¥ä¸€ä¸ªè¿œç¨‹ä¸»æœºæ—¶ï¼Œsshä¼šè·å–è¿œç¨‹ä¸»æœºçš„å…¬é’¥ï¼Œå®¢æˆ·ç«¯ä¼šä¿å­˜è¿™ä¸ªå…¬é’¥åˆ°è‡ªå·±çš„konwn_hostsæ–‡ä»¶ä¸­
  2. åç»­å†è¿æ¥åŒä¸€ä¸»æœºæ—¶ï¼Œå®¢æˆ·ç«¯å°±ä¼šå°†æ–°è·å–çš„ä¸»æœºå…¬é’¥åŒ™ä¸`known_hosts` æ–‡ä»¶ä¸­å­˜å‚¨çš„å…¬é’¥è¿›è¡Œæ¯”å¯¹
  3. å¦‚æœä¸¤è€…åŒ¹é…ï¼Œåˆ™è®¤ä¸ºè¿æ¥æ˜¯å®‰å…¨çš„ï¼›å¦‚æœä¸åŒ¹é…ï¼Œå®¢æˆ·ç«¯ä¼šå‘å‡ºè­¦å‘Šï¼Œæç¤ºä½ å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ï¼Œå› ä¸ºè¿™å¯èƒ½æ„å‘³ç€ä¸»æœºçš„èº«ä»½å‘ç”Ÿäº†å˜åŒ–æˆ–è€…å­˜åœ¨ä¸­é—´äººæ”»å‡»

  ![image-20250222134434209](/Users/soup/Library/Application Support/typora-user-images/image-20250222134434209.png)

### 3.3 å…¬é’¥å’Œç§é’¥

æ˜¯åŸºäºéå¯¹ç§°åŠ å¯†ç®—æ³•ç”Ÿæˆçš„ä¸€å¯¹å¯†é’¥

- å…¬é’¥åŠ å¯†çš„æ•°æ®åªèƒ½ç”¨å¯¹åº”çš„ç§é’¥è§£å¯†
- ç”¨ç§é’¥åŠ å¯†çš„æ•°æ®ï¼ˆå®é™…æ›´å¤šç”¨äºç­¾åï¼‰åªèƒ½ç”¨å¯¹åº”çš„å…¬é’¥è§£å¯†éªŒè¯

ä½¿ç”¨åœºæ™¯ï¼š

- æ•°æ®åŠ å¯†ä¼ è¾“ï¼šè·å–å¯¹æ–¹æœåŠ¡å™¨ä¿æŠ¤çš„æ•°æ®

  ![image-20250222140332457](/Users/soup/Library/Application Support/typora-user-images/image-20250222140332457.png)

- æ•°å­—ç­¾åï¼šéªŒè¯æ•°æ®çš„æ¥æºå’Œå®Œæ•´æ€§

  ![image-20250222140755053](/Users/soup/Library/Application Support/typora-user-images/image-20250222140755053.png)

- **`èº«ä»½éªŒè¯ï¼šSSHèº«ä»½éªŒè¯`**

  ![image-20250222141414443](/Users/soup/Library/Application Support/typora-user-images/image-20250222141414443.png)

### 3.4 è¿æ¥è¿œç¨‹æœåŠ¡å™¨çš„ä¸¤ç§åè®®

#### 1ã€httpsåè®®

é¦–æ¬¡è®¿gitlabçš„æ—¶å€™è¾“å…¥ç”¨æˆ·åå’ŒPersonal Access Token

#### 2ã€sshåè®®

1. ç”¨æˆ·æ‰§è¡Œ`git clone`å‘½ä»¤ï¼Œå®¢æˆ·ç«¯å°è¯•sshè¿æ¥åˆ°gitlabæœåŠ¡å™¨

2. æœåŠ¡å™¨éªŒè¯å®¢æˆ·ç«¯èº«ä»½

   ç”¨sshçš„èº«ä»½è®¤è¯æœºåˆ¶ï¼Œgitlabå‘é€éšæœºæ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ç”¨ç§é’¥ç­¾åéšæœºæ•°æ®ï¼Œå‘é€ç»™gitlabï¼Œgitlabç”¨å®¢æˆ·ç«¯çš„å…¬é’¥è§£å¯†ï¼Œå¦‚æœæ˜¯è¿™ä¸ªéšæœºæ•°æ®ï¼Œåˆ™èº«ä»½éªŒè¯æˆåŠŸã€‚

3. **å»ºç«‹å®‰å…¨è¿æ¥**ï¼š
   éªŒè¯é€šè¿‡åï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´å»ºç«‹åŠ å¯†çš„ SSH è¿æ¥ï¼Œç”¨æˆ·å¯ä»¥æ‰§è¡Œ Git æ“ä½œ

## 4ã€æ ¸å¿ƒæ¦‚å¿µ

job >> stage >> pipeline

![image-20250227171253742](/Users/soup/Library/Application Support/typora-user-images/image-20250227171253742.png)

### 4.1 jobï¼ˆä»»åŠ¡ï¼‰ï¼šä»»åŠ¡æ˜¯æµæ°´çº¿çš„æœ€å°æ‰§è¡Œå•å…ƒï¼Œå®šä¹‰äº†å…·ä½“çš„æ“ä½œï¼ˆå¦‚è¿è¡Œè„šæœ¬ã€ç¼–è¯‘ä»£ç ã€æ‰§è¡Œæµ‹è¯•ï¼‰

æ¯ä¸€ä¸ªjobå¿…é¡»å±äºæŸä¸€ä¸ªstage

### 4.2 stageï¼ˆé˜¶æ®µï¼‰ï¼šé˜¶æ®µæ˜¯æµæ°´çº¿ä¸­çš„é€»è¾‘åˆ†ç»„ï¼Œä¾‹å¦‚ `build`ã€`test`ã€`deploy`

ä¸€ä¸ªstageå¯ä»¥åŒ…å«å¤šä¸ªjobï¼ŒåŒä¸€ä¸ªstageé‡Œé¢çš„jobæ˜¯å¹¶è¡Œçš„ï¼Œä¸åŒstageçš„jobæ˜¯ä¸²è¡Œçš„

ä¸€ä¸ªstageæ‰§è¡Œå®Œåæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªstage

ä¸¾ä¸ªğŸŒ°

```
// æœ‰ä¸‰ä¸ªstageï¼šbuildã€testã€deployä¸‰ä¸ªé˜¶æ®µ
// ä¸‰ä¸ªä»»åŠ¡ï¼šbuild_jobï¼ˆå±äºbuildé˜¶æ®µï¼‰ã€test_jobï¼ˆå±äºtesté˜¶æ®µï¼‰ã€deploy_jobï¼ˆå±äºdeployé˜¶æ®µï¼‰

stages:
  - build
  - test
  - deploy

build_job:
  stage: build
  script:
    - echo "Building the project..."
    - make build

test_job:
  stage: test
  script:
    - echo "Running tests..."
    - make test

deploy_job:
  stage: deploy
  script:
    - echo "Deploying the project..."
    - make deploy
  only:
    - main
```

### 4.3 Pipelineï¼ˆæµæ°´çº¿ï¼‰ï¼šç”±ä¸€ç³»åˆ—çš„stageå’Œjobæ„æˆ

### 4.4 runnerï¼ˆæ‰§è¡Œå™¨ï¼‰ï¼šæ˜¯ä¸€ä¸ªç”¨äºæ‰§è¡Œ CI/CD æµæ°´çº¿ä¸­ job çš„åº”ç”¨ç¨‹åº

#### 4.4.1 runnerçš„ä½œç”¨

1. æ‰§è¡Œjob
2. ä¸ºjobæä¾›æ‰§è¡Œç¯å¢ƒï¼ˆè™šæ‹Ÿæœºã€dockerå®¹å™¨ç­‰ï¼‰
3. åˆ†å¸ƒå¼æ‰§è¡Œï¼šå¹¶è¡Œæ‰§è¡Œjob

å…¬å¸ä½¿ç”¨çš„æ˜¯gitlabç¤¾åŒºç‰ˆï¼Œæœ‰ä¸ªciæœåŠ¡å™¨ï¼Œè¿™ä¸ªciæœåŠ¡å™¨ä¸“é—¨è·‘è¿™ä¸ªrunnerï¼Œjobçš„æ•´ä¸ªæµç¨‹åœ¨runnerè¿è¡Œ

#### 4.4.2 è¡¥å……çŸ¥è¯†ç‚¹

`å¯ä»¥å…ˆçœ‹ä¸‹ç¬¬5ç‚¹è®¤è¯†ä¸‹gitlab`

å…¬å¸çš„gitlabè®¡åˆ’ç‰ˆæœ¬

<img src="/Users/soup/Library/Application Support/typora-user-images/image-20250227101856423.png" alt="image-20250227101856423" style="zoom:50%;" />

#### 4.4.3 runneråˆ†ç±»

![image-20250227142821651](/Users/soup/Library/Application Support/typora-user-images/image-20250227142821651.png)

- gitlab.comç‰ˆæœ¬çš„shared runnerç”±å®˜ç½‘æä¾›ï¼Œè‡ªå·±ä¹Ÿå¯ä»¥é…ç½®specific runnerå’Œgroup runner

- è‡ªæ‰˜ç®¡ç‰ˆæœ¬çš„éƒ½éœ€è¦è‡ªå·±é…ç½®

#### 4.4.4 å…¬å¸çš„runner

åœ¨å…¬å¸çš„é¡¹ç›®ä¸­æˆ–è€…ç¾¤ç»„é‡Œé¢éƒ½æ‰¾ä¸åˆ°runnerçš„é…ç½®ï¼Œä½¿ç”¨çš„æ˜¯å…è´¹ç‰ˆï¼Ÿå¥¶å¥¶çš„ï¼Œæ˜¯æˆ‘æ²¡æœ‰æƒé™ï¼ï¼

è¦åˆ°äº†ä¸¤ä¸ªå°æ—¶çš„æƒé™ï¼Œå˜»å˜»

å…¬å¸çš„runnerçŠ¶æ€

![image-20250227143215038](/Users/soup/Library/Application Support/typora-user-images/image-20250227143215038.png)

#39æ˜¯å…¬å¸é¡¹ç›®çš„å…¬ç”¨runner

![image-20250227143410618](/Users/soup/Library/Application Support/typora-user-images/image-20250227143410618.png)

#### äº‹æ•…ï¼ï¼

æœ‰ä¸€æ¬¡å…¬å¸çš„ciè·‘ä¸äº†äº†ï¼Œå°±æ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„runnerèµ„æºä¸å¤Ÿäº†ï¼Œè¦æ‹“å±•ã€‚

### 4.5 .gitlab-ci.ymæ–‡ä»¶

ç¼–å†™ä¸€ä¸ªå¯ä»¥æ‰§è¡Œçš„ciæ–‡ä»¶ï¼Œä¸€ä¸ªciæ–‡ä»¶ç”±ä¸‹åˆ—å››ä¸ªæ„æˆï¼Œéƒ½æ˜¯ä¸ºjobæä¾›é…ç½®

- stagesï¼šé˜¶æ®µ

  ```
  stages:
    - build
    - test
    - deploy
  ```

- job

  ```yaml
  job2:	// jobçš„åç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰
  	stage: build // jobå¯¹åº”çš„stageé˜¶æ®µ
    script:	// è¦æ‰§è¡Œçš„è„šæœ¬å‘½ä»¤
      - echo "This is job 2"
      - npm install
      - npm test
  ```

- variableï¼šå˜é‡

  ```
  variables:
    APP_NAME: "my_app"
    NODE_VERSION: "14"
  ```

- defaultï¼šé»˜è®¤jobçš„å®šä¹‰

  ```
  default:
    image: node:14   ä½¿ç”¨node14çš„nodeé•œåƒ
    tags:
      - docker			 ä½¿ç”¨æ ‡ç­¾ä¸ºdockerå’Œlinuxçš„runner
      - linux
  ```

ä¸€èˆ¬æ¥è¯´stagesçš„å¸¸è§é˜¶æ®µï¼šbuildã€testã€deployã€reviewã€packageã€uploadã€imageã€æˆ–è€…è‡ªå®šä¹‰

å…³é”®è¯­æ³•å…ƒç´ å¯ä»¥è‡ªè¡Œæœç´¢

```
job:
	stage: build 		****1jobå¯¹åº”çš„stageé˜¶æ®µ
	
	
	rules: 					****2 ç”¨äºæ§åˆ¶ `job` çš„æ‰§è¡Œæ¡ä»¶ï¼Œå¯æ ¹æ®ä¸åŒçš„æ¡ä»¶å†³å®šæ˜¯å¦æ‰§è¡ŒæŸä¸ª `job`
    - if: '$CI_COMMIT_BRANCH == "main"'
      when: always // æ€»æ˜¯æ‰§è¡Œ
    - if: '$CI_MERGE_REQUEST_ID'
      when: manual // æ‰‹åŠ¨è§¦å‘æ‰§è¡Œ
      
 
  cache: 					****3 ç”¨äºç¼“å­˜
    paths:
      - node_modules/ 
      
      
  artifacts:      ****4 å°†dist/æ–‡ä»¶ä¸‹å­˜ä¸ºåˆ¶å“ 
    paths:
      - dist/
      
      
  script:					****5 æ‰§è¡Œçš„è„šæœ¬å‘½ä»¤
    - npm install
    - npm run build
```

## 5ã€gitlab

åˆ†ç±»æ€»ç»“å›¾

![image-20250227140452945](/Users/soup/Library/Application Support/typora-user-images/image-20250227140452945.png)

gitlabæœ‰ä¸¤ç§ç‰ˆæœ¬ï¼š

- GitLab SaaS æœåŠ¡ï¼ˆGitLab.comï¼‰ï¼šç›´æ¥ç½‘ç«™è®¿é—®ï¼Œç”± GitLab å®˜æ–¹æ‰˜ç®¡ï¼Œç”¨æˆ·æ— éœ€ç®¡ç†åŸºç¡€è®¾æ–½ã€‚

  æœ‰ä¸‰ç§è®¡åˆ’ï¼Œæ¯ç§ç‰ˆæœ¬ä¸­åˆæœ‰ç¤¾åŒºç‰ˆå’Œä¼ä¸šç‰ˆ

  ![image-20250226175016229](/Users/soup/Library/Application Support/typora-user-images/image-20250226175016229.png)

- **è‡ªæ‰˜ç®¡ GitLab**ï¼šç”¨æˆ·åœ¨è‡ªå·±çš„æœåŠ¡å™¨æˆ–äº‘ç¯å¢ƒä¸­éƒ¨ç½²

  å…¬å¸ä½¿ç”¨çš„æ˜¯`è‡ªæ‰˜ç®¡gitlab`

  ![image-20250227144940663](/Users/soup/Library/Application Support/typora-user-images/image-20250227144940663.png)

  ä½¿ç”¨æ–¹ä¾¿å¥½è®°çš„åŸŸåï¼šhttps://gitlab.dreamdev.cn/

## 6ã€gitlab ci/cdçš„å·¥ä½œè¿‡ç¨‹

1. ä»£ç æ¨é€

2. è§¦å‘æµæ°´çº¿

   gitlabç›‘æµ‹åˆ°ä»£ç å˜æ›´ï¼Œæ ¹æ®.gitlab-ci.ymlæ–‡ä»¶è§¦å‘æµæ°´çº¿

3. æ‰§è¡Œä»»åŠ¡

   runneræŒ‰ç…§æµæ°´çº¿é…ç½®æ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æ„å»ºã€æµ‹è¯•ã€éƒ¨ç½²

4. ç”ŸæˆæŠ¥å‘Š

   å®Œæˆä»»åŠ¡åç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰ä¸€ä¸ªæŠ¥å‘Š

5. éƒ¨ç½²

   å¦‚æœæ‰€æœ‰ä»»åŠ¡æˆåŠŸï¼Œä»£ç ä¼šè‡ªåŠ¨æˆ–æ‰‹åŠ¨éƒ¨ç½²åˆ°ç›®æ ‡ç¯å¢ƒ

## æ€è€ƒ

### 1ã€deployé˜¶æ®µè·Ÿgitlabå’Œé˜¿é‡Œäº‘æœåŠ¡å™¨çš„å…³ç³»

åœ¨deployé˜¶æ®µå°†äº§ç‰©ä¸Šä¼ åˆ°ä¸ƒç‰›äº‘ï¼Œé˜¿é‡Œäº‘é…ç½®è¿™ä¸ªåœ°å€ï¼Ÿé˜¿é‡Œäº‘çš„å¦‚ä½•æ‹‰å–éƒ¨ç½²ï¼Ÿ

çˆ±å­¦ç½‘æœ‰ä¸¤ä¸ªè®¿é—®åŸŸå

https://ebag-test.readboy.com/ai-learn-pc/index/workbench#/

https://aixue.readboy.com/ai-learn-pc/login

çœ‹ä¸‹æ˜¯å¦æ˜¯é˜¿é‡Œäº‘é…ç½®äº†ä¸¤ä¸ªåŸŸå

è®¿é—®bucketä¸­çš„èµ„æºä¹Ÿå¯ä»¥è®¿é—®ï¼šhttps://rbebag-zy-test.strongwind.cn/ai-learn-pc/index/assignment

### 2ã€uploadä¸Šä¼ èµ„æºåˆ°ä¸ƒç‰›äº‘çš„é˜¶æ®µï¼Ÿ

åŠ è½½ä¸ƒç‰›äº‘çš„é…ç½®æ–‡ä»¶

![image-20250224104623478](/Users/soup/Library/Application Support/typora-user-images/image-20250224104623478.png)

### 3ã€æ“ä½œä¸€ä¸‹ä½¿ç”¨ciéƒ¨ç½²ä¸€å¥—å…¨æµç¨‹å¯ä»¥è®¿é—®ç½‘ç«™

ã€‚ã€‚ã€‚å“ˆå“ˆå“ˆ

å®æˆ˜è½¬åˆ°ã€Šéƒ¨ç½²ä¸€å¥—gitlabå®ç°ciæµæ°´çº¿.mdã€‹

### 4ã€ä»€ä¹ˆæ˜¯gitlabå®ä¾‹ï¼Ÿ

æ˜¯åœ¨ç‰¹å®šç¯å¢ƒä¸­éƒ¨ç½²å’Œè¿è¡Œçš„ä¸€ä¸ªç‹¬ç«‹çš„gitlabæœåŠ¡ç³»ç»Ÿ

`GitLab æ˜¯ä¸€ä¸ªåŸºäº Web çš„ Git ä»“åº“ç®¡ç†å·¥å…·ï¼Œæä¾›äº†ä»£ç æ‰˜ç®¡ã€ç‰ˆæœ¬æ§åˆ¶ã€é¡¹ç›®ç®¡ç†ã€æŒç»­é›†æˆä¸æŒç»­éƒ¨ç½²ï¼ˆCI/CDï¼‰ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚è€Œ GitLab å®ä¾‹å°±æ˜¯è¿™ä¸ªå·¥å…·åœ¨å…·ä½“ç¯å¢ƒä¸­çš„å®é™…è¿è¡Œä½“ï¼Œå®ƒå°±åƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è½¯ä»¶å‰¯æœ¬ï¼Œæ‹¥æœ‰è‡ªå·±çš„é…ç½®ã€æ•°æ®å’Œç”¨æˆ·ç¾¤ä½“ã€‚`

éƒ¨ç½²å½¢å¼ï¼š

1. è‡ªæ‰˜ç®¡å®ä¾‹ï¼šå…¬å¸è‡ªå·±æ­å»ºå’Œç®¡ç†gitlabæœåŠ¡å™¨
2. äº‘æ‰˜ç®¡å®ä¾‹ï¼šç®€å•è¯´å°±æ˜¯ç”±å®˜æ–¹è‡ªå·±çš„æä¾›çš„æœåŠ¡å™¨ï¼Œåœ¨gitlab.comå¯ä»¥ç›´æ¥æ“ä½œ

### 5ã€ç»ƒä¹ ï¼šåˆ†æä¸‹å…¬å¸çš„gitlab-ci.ymlæ–‡ä»¶

`åœ¨åŒç›®å½•æ–‡ä»¶ä¸‹ï¼šåˆ†æä¸€ä¸ªå…·ä½“ç”Ÿäº§ç¯å¢ƒä¸‹gitlab-ci.ymlæ–‡ä»¶.md`
